<main>
  <section id="memee">
    <%=render "dashboard/sidebar" %>
    <div id="tormnt" class="main_side">
      <div id="top_header">
        <div class="left_blk">
          <h1>Tournaments</h1>
          <div class="img">
            <img src="<%= asset_path("icon-header.svg")%>" alt="">
          </div>
        </div>
        <div class="d-flex align-items-center">
          <%=render "dashboard/notification_panel" %>
        </div>
      </div>
      <div class="inner_blk tornment">
        <div class="top">
          <div class="season_detail">
            <h4 class="mb-0">Tournament Season</h4>
            <div id="toast" class="toast" style="display: none;"></div>
            <div class="form_blk">
              <%= form_for :post, :url => { :controller => 'dashboard', :action => 'tournament' }, :html => { :method => 'get', class: 'form_blk' } do |f| %>
                <% if TournamentBanner.exists? %>
                  <%= select_tag  :tournament_banner_id, options_for_select(TournamentBanner.all.order(start_date: :desc).pluck(:title, :id),selected: @tournament_banner_name&.present? ? @tournament_banner_name : TournamentBanner&.last&.id), class: "input" ,onchange: "submit()" %>
                <% else %>
                  <%= select_tag :tournament_banner_id, 
                                options_for_select([['No active tournament', '']]), 
                                class: "input", 
                                disabled: false %>
                <% end %>
              <% end %>
            </div>
            <% if TournamentBanner.exists? %>
              <p class="ms-3"> Participants: <span id = "joined" style="font-size: 2.4rem"><%= if @banner.present?
                                                                                                @banner.tournament_users.count
                                                                                              else
                                                                                                TournamentBanner.last.present? ? TournamentBanner.last.tournament_users.count : ""
                                                                                            end %> </span></p>
            <%end%>  
            </div>
            <% if TournamentBanner.exists? %>
              <h4 class="fw_400 mb-0">
                <a href="/tournament-winner-list" id = "banner_id">Tournament Winners</a>
              </h4>
            <%end%>
        </div>
        <div id="table_blk" style="overflow:visible !important;">
          <table id="tournament_table">
            <thead>
            <tr id = "tr">
              <th style=" width: 6rem">Rank</th>
              <th style="width: 15rem">Name</th>
              <th style="width: 22rem">Email</th>
              <th style="width: 22rem"> # of times Participated</th>
              <th style="width: 10.6rem">Up Vote</th>
              <th style="width: 13rem">Down Vote</th>
              <th style="width: 13rem">Date Joined</th>
              <th style="width: 10rem">Image</th>
              <th style="width: 8rem">Status</th>
              <th style="width: 2rem"></th>
            </tr>
            </thead>
            <tbody>
            <%# i = 1 %>
            <% first_record_value = @posts.length %>
            <%# if @posts.present? %>
              <%# banner = TournamentBanner.find(@posts.first.tournament_banner_id).tournament_users.count %>
              <%# if banner > 10 %>
                <%# first_record_value =  abc.split("<b>")[1].split("&")[0].to_i unless abc == "No entires found" %>
              <%# elsif banner == 1 %>
                <%# first_record_value =  abc.split(" ")[5].to_i unless abc == "No entires found" %>
              <%# else %>
                <%# first_record_value =  abc.split(" ")[1].to_i unless abc == "No entires found" %>
              <%# end %>
            <%# end %>
            <% counter =  first_record_value > 10 ?  first_record_value : params[:page].to_i > 1 ? (params[:page].to_i - 1) * 10  : 0%>
            <% @posts.each do |post| %>
            
              <tr >
                <td>
                  <% counter += 1 %>
                  <% if counter < 4 %>
                    <div class="win"><%=counter%></div>
                  <% elsif counter <= 10 %>
                    <div class="win win_5"><%=counter%></div>
                  <% else %>
                    <div class="win win_10"><%=counter%></div>
                  <% end %>
                </td>
                <td><%= post.user.try(:username) %></td>
                <td><%=post.user.try(:email) %></td>
                <td style="cursor: pointer;" onclick="openSidebar('<%=post.user.username %>','<%=post.user.email %>','<%=post.user.id %>', '<%= post.tournament_banner_id %>')"><%= @banner.present? ? @banner.posts.where(user_id: post&.user&.id).count : TournamentBanner.last.posts.where(user_id: post.user.id).count %>  </td>
                <td class="like-count" ><%=post.likes.where(is_judged: true).like.count %></td>
                <td><%=post.likes.where(is_judged: true).dislike.count%></td>
                <% banner_id = @banner.present? ? @banner.id : TournamentBanner.last.id %>
                <td><%=post.user.tournament_users.find_by(tournament_banner_id: banner_id).created_at.strftime('%b %d, %Y') %></td>
                <td>
                  <div class="img">
                    <img src="<%= post.post_image.attached? && post.post_image.content_type.split('/').first == "image" ? post.post_image.blob.url : post&.video_thumbnail&.blob&.url %> " alt="">
                  </div>
                </td>
                <% @tournament = @banner.present? ? @banner : TournamentBanner&.last%>
               <% if @tournament.present? %>
                  <% if @tournament.end_date.to_date <= Date.today %>
                    <td>finished</td>
                  <% else %>
                    <td>ongoing</td>
                  <% end %>
                <% end %>

                <td>
                  <div class="dropdown">
                    <button class="btn drop_btn" data-bs-toggle="dropdown">
                      <img src="<%= asset_path("icon-vdots.svg")%>" alt="">
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                      <li><button type="button" onclick="flagTournamentPost('<%= post.user.id %>', '<%= post.id %>')">Flag Post</button></li>
                      <li>
                        <% username = post.user.username %>
                        <% email = post.user.email %>
                        <% likes = post.likes.where(status: "like").count %>
                        <% created = post.user.tournament_users&.first&.created_at.strftime('%b %d, %Y') %>
                        <% dislikes = post.likes.where(status: "dislike").count %>
                        <% url = post.post_image.present? ? post.post_image.blob.url : asset_path("tr-1.jpg") %>
                        <% content_type = post.post_image.present? ? post.post_image.content_type.split('/').first : "" %>
                        <% joined_tournaments_count = TournamentUser.where(user_id: post.user.id).count %>

                      </li>
                    </ul>
                  </div>
                </td>
              </tr>
            <%end %>
            </tbody>
          </table>
        </div>
        <div class="paginate_sec">
          <p><%= page_entries_info @posts , :html => false %></p>
          <ul class="pagination">
            <li class="disabled"> <%= will_paginate(@posts, :class => "h5 text-white", :outer_window => 0, :inner_window => 1) %></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="popup" data-popup="trans_profile" id="tormnt_modal">
      <div class="table_dv">
        <div class="table_cell">
          <div class="contain">
            <div class="row justify-content-center">
              <div class="col-12">
                <div class="_inner">
                  <button type="button" class="x_btn" onclick="close_tormnt_modal()"></button>
                  <h3>Rewards</h3>
                  <div class="detail_blk">
                    <div class="left_blk">
                      <table>
                        <thead>
                        <tr>
                          <th style="width: 13rem;">Name</th>
                          <th style="width: 22rem;">Email</th>
                          <th>Date Joined</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                          <td id="tournament_user_name"></td>
                          <td id="tournament_user_email"></td>
                          <td id="tournament_user_joined"></td>
                        </tr>
                        </tbody>
                      </table>
                      <%= form_with(url: winner_reward_path, method: "get") do |f| %>
                        <div class="row">
                          <div class="col-12">
                            <h6 class="form_label">Gift Card #</h6>
                            <div class="form_blk">
                              <input type="text" id="gift_card_number" class="input" placeholder="000000" required>
                              <%= f.text_field :rank, id: "rank", hidden: true %>
                            </div>
                          </div>
                          <div class="col-12">
                            <h6 class="form_label">Coin</h6>
                            <div class="form_blk">
                              <input type="number" id="coins" class="input" placeholder="Enter Coins" required>
                            </div>
                          </div>
                          <div class="btn_blk mt-5" id="reward_btn">
                            <button class="site_btn prime_btn round w-100" onclick= "get_user_name()">Send</button>
                          </div>
                        </div>
                      <% end %>
                    </div>
                    <div class="right_blk">
                      <div class="img">
                        <img src="" alt="" id="image">
                         <video controls>
                            <source src="" type="video/mp4" alt="" id="video">
                          </video>
                      </div>
                      <div class="vote_blk">
                        <span class="vote" style="padding-right:25px">
                          <img src="<%= asset_path("icon-vote-up.svg") %>" alt="">
                          <span id="user_likes" style="text-decoration:underline;"></span>
                        <div clas="btn-group" style="position:absolute; right:0">



                     <a id='up-btn'>   <img style="width:35px; cursor:pointer;margin-bottom:3px;" src="<%= asset_path("up-btn.png") %>" alt=""> </a>
                     <a id='down-btn'>   <img style="width:35px; cursor:pointer;margin-bottom:3px;" src="<%= asset_path("down-btn.png") %>" alt=""> </a>

                        </div>
                        </span>
                        <span class="vote vote_down" style="padding-right:25px">
                          <img src="<%= asset_path("icon-vote-down.svg") %>" alt="">
                          <span id="user_dislikes" style="text-decoration:underline;"></span> <div clas="btn-group" style="position:absolute; right:0">


                     <a id='dislike-up-btn'>   <img style="width:35px; cursor:pointer;margin-bottom:3px;" src="<%= asset_path("up-btn.png") %>" alt=""> </a>
                     <a id='dislike-down-btn'>   <img style="width:35px; cursor:pointer;margin-bottom:3px;" src="<%= asset_path("down-btn.png") %>" alt=""> </a>


                          </div>
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="popup" data-popup="trans_profile" id="tormnt_modal">
      <div class="table_dv">
        <div class="table_cell">
          <div class="contain">
            <div class="row justify-content-center">
              <div class="col-12">
                <div class="_inner">
                  <button type="button" class="x_btn"></button>
                  <h3>Reward</h3>
                  <div class="detail_blk">
                    <div class="left_blk">
                      <table>
                        <thead>
                        <tr>
                          <th style="width: 13rem;">Name</th>
                          <th style="width: 22rem;">Email</th>
                          <th>Date Joined</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                          <td>Mr Astronut</td>
                          <td>iammemer@memee.com</td>
                          <td>Jan 1, 2022</td>
                        </tr>
                        </tbody>
                      </table>
                      <form action="">
                        <div class="row">
                          <div class="col-12">
                            <h6 class="form_label">Gift Card #</h6>
                            <div class="form_blk">
                              <input type="text" class="input" placeholder="000000">
                            </div>
                          </div>
                          <div class="col-12">
                            <h6 class="form_label">Coin</h6>
                            <div class="form_blk">
                              <input type="text" class="input" value="2334">
                            </div>
                          </div>
                        </div>
                        <div class="btn_blk">
                          <button type="button"
                                  class="site_btn prime_btn round w-100">Send</button>
                        </div>
                      </form>
                    </div>
                    <div class="right_blk">
                      <div class="img">
                        <img src="<%= asset_path("tormnt-modal.jpg")%>" alt="">
                      </div>
                      <div class="vote_blk">
                                                <span class="vote">
                                                    <img src="<%= asset_path("icon-vote-up.svg")%>" alt="">
                                                    324
                                                </span>
                        <span class="vote vote_down">
                                                    <img src="<%= asset_path("icon-vote-down.svg")%>" alt="">
                                                    12
                                                </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div id="cart-box" class="sidebar">
  <div id="tormnt_modal">
      <h3># of Participated</h3>
      <button type="button" class="x_btn" onclick="closeSidebar()"></button>
      <div class="detail_blk">
          <div class="left_blk" style="width:100%">
              <table>
                  <thead>
                      <tr>
                          <th style="width: 13rem;">Name</th>
                          <th style="width: 22rem;">Email</th>
                      </tr>
                  </thead>
                  <tbody>
                      <tr>
                          <td id="sidebar_user_name"></td>
                          <td id="sidebar_user_email"></td>
                      </tr>
                  </tbody>
              </table>
              <%# <div class="text-white mb-5">4 of 999 ...</div> %>
          </div>
      </div>


      <div class="sibarPosts">
          
      </div>


      
      <div>



      
</div>


</main>

<style>
.sidebar {
  height: 100%;
  width: 400px;
  position: fixed;
  top: 0;
  right: -400px;
  border-radius: 40px 0px 0px 40px;
  border: 2px solid #5D5D5D;
  border-right:none;
  background: #201E23;
  overflow-x: hidden;
  transition: 0.5s;
  z-index:99;
}

.sidebar table {
  max-width:75%;
}
.sidebar #tormnt_modal {
  padding: 20px;
}
.sidebar .x_btn{
min-width: 38px !important;
width: 38px !important;
height: 39px !important;
top: 12px !important;
right: 12px !important;
}
.sidebar .x_btn::before{
width:25% !important;
height:25% !important;
}

.sidebar #tormnt_modal .detail_blk .right_blk{
width: 65%;
}
.sidebar #tormnt_modal .detail_blk .right_blk.custom-right-side{
  background:transparent;
  padding-top:0;
  width:35%
}
.sidebar #tormnt_modal .detail_blk .right_blk.custom-right-side .vote_blk{
  flex-direction: column !important;
  align-items: flex-start;
}
.toast {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 10px 20px;
    font-size: 14px;
    color: white;
    border-radius: 5px;
    z-index: 1000;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    animation: fade-in-out 10s forwards;
}

/* Success toast background */
.toast.success {
    background-color: #198754;
}

/* Error toast background */
.toast.error {
    background-color: #dc3545;
}

/* Keyframes for fade-in-out */
@keyframes fade-in-out {
    0% { opacity: 0; transform: translateY(20px); }
    10% { opacity: 1; transform: translateY(0); }
    90% { opacity: 1; transform: translateY(0); }
    100% { opacity: 0; transform: translateY(20px); }
}
</style>


<script>


  function openSidebar(username , email , userId, bannerId) {
    console.log("User id in the sidebar === ", userId , '---email===', email,'-----username---',username,'---bannerId-----',bannerId)

    document.getElementById("cart-box").style.right = "0px"; 
    document.getElementById("sidebar_user_name").innerHTML= username
    document.getElementById("sidebar_user_email").innerHTML= email
  
      $.ajax({
      type: "GET",
      url: "user_tournament_posts",
      data: { tournament_banner_id: bannerId ,user_id: userId },
      success: function(response) {
        if (response) {
          console.log("Response of the posts in sidebar --- ",response );

        $('.sibarPosts').html('');
        response?.posts?.forEach((item , ind)=>{
          // console.log("Inside the loop === ", item);
          var sidebarHTML = generateSidebarHTML(item , ind) ;
          // console.log(sidebarHTML);
           $('.sibarPosts').append(sidebarHTML);

        })

        } else {
          response.posts.forEach(function(post) {
            $("#userPosts").append("<p>" + post.title + "</p>");
          });
        }
      },
      error: function(error) {
        console.log("Error fetching user posts: ", error);
      }
    });
  }

  function generateSidebarHTML(item, ind){
        const mediaHTML = item.image_type === "video"
          ? `<video controls style="width: 200px; height: 200px;">
              <source src="${item?.post_image}" type="video/mp4">
              Your browser does not support the video tag.
            </video>`
          : `<img style="width: 200px; height: 300px; object-fit: fill !important" src="${item?.post_image}" alt="">`;
          return  `
                  <div class="mb-3">
                    <div style="color: #939394">Date Posted</div>
                    <div class="text-white mb-3">${item?.created_at}</div>
                    <div class="detail_blk mt-0" style="align-items: flex-start">
                      <div class="right_blk">
                        <div class="img">
                          ${mediaHTML}
                        </div>
                      </div>
                      <div class="right_blk custom-right-side">
                        <div class="vote_blk">
                          <span class="vote" style="padding-right: 5px">
                            <img src="<%= asset_path("icon-vote-up.svg") %>" alt="">
                            <span id="side_user_likes-${ind}" style="text-decoration: underline">${item?.likes}</span>
                            <div class="btn-group" style="position: absolute; right: 0; flex-direction: column">

                             
                            </div>
                          </span>
                          <span class="vote vote_down" style="padding-right: 5px">
                            <img src="<%= asset_path("icon-vote-down.svg") %>" alt="">
                            <span id="side_user_dislikes-${ind}" style="text-decoration: underline">${item?.dislikes}</span>
                            <div class="btn-group" style="position: absolute; right: 0; flex-direction: column">

                            
                            </div>
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                `
  }

  function closeSidebar() {
    document.getElementById("cart-box").style.right = "-400px";
            location.reload();

  }
</script>


<script>
    $('#tournament_id').click(function (){
        var radioValue = $("input[name='tournament_id']").val();
        $('#tournament_id').data('attribute',radioValue);
        $.ajax({
            type: "Get",
            url: "/tournament",
            data: { tournament_banner_id: radioValue},
            success: (response) => {
            }
        });
    });

    function open_trmnt_model(){
        document.getElementById("tormnt_modal").style.display="block"
    }

   function flagTournamentPost(id, post_id) {
    $.ajax({
        type: "GET",
        url: "flag_tournament_post",
        data: { user_id: id, post_id: post_id },
        success: function(response) {
          console.log("success");
            // Show a toast message on success
            showToast("Tournament post flagged successfully!");
            location.reload();
        },
        error: function(xhr, status, error) {
            // Show a toast message on error
            showToast("Failed to flag the tournament post. Please try again.", true);
        }
    });
}

// Toast display function
function showToast(message, isError = false) {
    console.log("Inside toast");
    const toast = document.getElementById("toast");

    // Set the message and class
    toast.innerText = message;
    toast.className = `toast ${isError ? "error" : "success"}`;

    // Show the toast
    toast.style.display = "block";

    // Automatically hide the toast after 3 seconds
   setTimeout(() => {
        toast.style.display = "none";
        if (typeof callback === "function") {
            callback(); // Execute the callback function
        }
    }, 3000);
}


    function increaseLikeCount(postId, ind ) {
    console.log("Increase postId:", postId, '---index----', ind);
    $.ajax({
        type: 'GET',
        url: 'increase_post_like_count', 
        data: { post_id: postId },
        success: function(response) {
            console.log('Like count increased for post ID:>>>>>> ' , response);

            var currentLikes = parseInt(document.getElementById("user_likes").innerHTML);
              console.log("Curerent likes outer ==== ", currentLikes);
              if(isNaN(currentLikes)){
                currentLikes = parseInt(document.getElementById(`side_user_likes-${ind}`).innerHTML)
                console.log("Curerent likes inner ==== ", currentLikes);
                var sideLikes = currentLikes + 1;
                document.getElementById(`side_user_likes-${ind}`).innerHTML = sideLikes;
                return;
               }

            var updatedLikes = currentLikes + 1;
            document.getElementById("user_likes").innerHTML = updatedLikes;
        },

        error: function(xhr, status, error) {
            console.error('Error increasing like count:', error);
        }
    });
}

function decreaseLikeCount(postId, ind ) {
    console.log("Decrese count postId:", postId, '----index---', ind);
    var currentLikes = parseInt(document.getElementById(`user_likes`).innerHTML);
    if(isNaN(currentLikes)){
        currentLikes = parseInt(document.getElementById(`side_user_likes-${ind}`).innerHTML);
    }
    
    if(currentLikes){ 
    $.ajax({
        type: 'GET',
        url: 'decrease_post_like_count', 
        data: { post_id: postId },
        success: function(response) {
            console.log('Like count decreased for post ID:>>>>>> ' , response);

            var currentLikes = parseInt(document.getElementById(`user_likes`).innerHTML);
              console.log("Curerent likes outer ==== ", currentLikes);
              if(isNaN(currentLikes)){
                currentLikes = parseInt(document.getElementById(`side_user_likes-${ind}`).innerHTML)
                console.log("Curerent likes inner ==== ", currentLikes);
                var sideLikes = currentLikes - 1;
                document.getElementById(`side_user_likes-${ind}`).innerHTML = sideLikes;
                return;
               }
                 var updatedLikes = currentLikes - 1;
                 document.getElementById("user_likes").innerHTML = updatedLikes;

        },
        error: function(xhr, status, error) {
            console.error('Error increasing like count:', error);
        }
    });
  }
}



function increaseDislikeCount(postId, ind ) {
  console.log("Dislike Increase postId:", postId, "ind -- ", ind);
  $.ajax({
      type: 'GET',
      url: 'increase_post_dislike_count', 
      data: { post_id: postId },
      success: function(response) {
          console.log('Dislike count increased for post ID:>>>>>> ' , response);

          var currentLikes = parseInt(document.getElementById("user_dislikes").innerHTML);
              console.log("Curerent likes outer ==== ", currentLikes);
              if(isNaN(currentLikes)){
                currentLikes = parseInt(document.getElementById(`side_user_dislikes-${ind}`).innerHTML)
                console.log("Curerent likes inner ==== ", currentLikes);
                var sideLikes = currentLikes + 1;
                document.getElementById(`side_user_dislikes-${ind}`).innerHTML = sideLikes;
                return;
               }

            var updatedLikes = currentLikes + 1;
            document.getElementById("user_dislikes").innerHTML = updatedLikes;


          
      },
      error: function(xhr, status, error) {
          console.error('Error increasing like count:', error);
      }
  });
}

function decreaseDislikeCount(postId, ind ) {
  var currentLikes = parseInt(document.getElementById("user_dislikes").innerHTML);
  if(isNaN(currentLikes)){
    currentLikes = parseInt(document.getElementById(`side_user_dislikes-${ind}`).innerHTML);
  }
if(currentLikes){
  $.ajax({
      type: 'GET',
      url: 'decrease_post_dislike_count', 
      data: { post_id: postId },
      success: function(response) {
          console.log('Dislike count increased for post ID:>>>>>> ' , response);

           var currentLikes = parseInt(document.getElementById("user_dislikes").innerHTML);
              console.log("Curerent likes outer ==== ", currentLikes);
              if(isNaN(currentLikes)){
                currentLikes = parseInt(document.getElementById(`side_user_dislikes-${ind}`).innerHTML)
                console.log("Curerent likes inner ==== ", currentLikes);
                var sideLikes = currentLikes - 1;
                document.getElementById(`side_user_dislikes-${ind}`).innerHTML = sideLikes;
                return;
               }

            var updatedLikes = currentLikes - 1;
            document.getElementById("user_dislikes").innerHTML = updatedLikes;

      },
      error: function(xhr, status, error) {
          console.error('Error increasing like count:', error);
      }
  });
    }
}


    function open_tormnt_modal(name, email, likes, created, dislike, url, rank, postId, content_type){
        console.log("content type:" , content_type)
        document.getElementById("tormnt_modal").style.display="block"
        document.getElementById("tournament_user_name").innerHTML= name
        document.getElementById("tournament_user_email").innerHTML= email
        document.getElementById("tournament_user_joined").innerHTML= created
        document.getElementById("user_likes").innerHTML= likes
        document.getElementById("user_dislikes").innerHTML= dislike
        if (content_type === 'image')
        {
          document.getElementById("image").src = url
        }
        else
        {        
          document.getElementById("video").src = url
        }
                document.getElementById('up-btn').setAttribute('onclick', 'increaseLikeCount(' + postId + ')')
        document.getElementById('down-btn').setAttribute('onclick', 'decreaseLikeCount(' + postId + ')')
        
        document.getElementById('dislike-up-btn').setAttribute('onclick', 'increaseDislikeCount(' + postId + ')')
        document.getElementById('dislike-down-btn').setAttribute('onclick', 'decreaseDislikeCount(' + postId + ')')
        $('#rank')[0].value = rank-1

        console.log("Post console === ", postId , "----------",likes)
    }

    function get_user_name(){
        var name = document.getElementById("tournament_user_name").innerHTML
        var card_number = document.getElementById("gift_card_number").value
        var coins = document.getElementById("coins").value
        var tourmnt = "Tournament"
        var rank =  document.getElementById("rank").value
        if(card_number !== "" && coins !== "") {
            $.ajax({
                type: "GET",
                url: "winner-reward",
                data: {name: name, card_number: card_number, coins: coins, tournament: tourmnt,rank: rank},
                success: function () {
                    document.getElementById("tormnt_modal").style.display = "none"
                }
            })
        }
    }

    function close_tormnt_modal(){
        document.getElementById("tormnt_modal").style.display="none"
        location.reload();
    }

</script>